name: Windows

on:
  pull_request:
    branches: [ "master" ]
  push:

jobs:
  get-wx-windows:
    runs-on: windows-latest
    steps:
      - name: Cache WX x86 Windows
        id: cache-wx-x86
        uses: actions/cache@v3
        with:
          path: C:/Program Files (x86)/wxWidgets
          key: wx-build-3.2.4-windows-x86
          restore-keys: |
            wx-build-3.2.4-windows-x86

      - name: Checkout WX Windows
        if: steps.cache-wx-x86.outputs.cache-hit != 'true'
        uses: actions/checkout@v3
        with:
          repository: WxWidgets/WxWidgets
          ref: v3.2.4
          path: ${{ github.workspace }}/wxWidgets
          submodules: 'true'

      - name: Configure WX x86 Windows
        if: steps.cache-wx-x86.outputs.cache-hit != 'true'
        run: >
          cmake ${{ github.workspace  }}/WxWidgets
          -DwxBUILD_SHARED=OFF
          -B ${{ github.workspace }}/wx-build-windows-x86

      - name: Build WX x86 Windows
        if: steps.cache-wx-x86.outputs.cache-hit != 'true'
        run: > 
          cmake --build ${{ github.workspace }}/wx-build-windows-x86 
          --target install --config Release 
  run-mfpg:
    needs: get-wx-windows
    uses: ./.github/workflows/wf-main.yml
    with: 
      os: windows-latest
      c-compiler: cl
      cxx-compiler: cl
      mx-rebuild: false
      build-tests: true
      build-type: Release
